# üñ®Ô∏è 3D Printer Power Manager –¥–ª—è DTEK - Standalone Edition

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è 3D –ø—Ä–∏–Ω—Ç–µ—Ä–æ–º –ø—ñ–¥ —á–∞—Å –ø–ª–∞–Ω–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –î–¢–ï–ö **–±–µ–∑ Docker** - –ø—Ä–æ—Å—Ç–æ Python —Å–∫—Ä–∏–ø—Ç!

## üéØ –û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

- ‚è∏Ô∏è **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–∞—É–∑–∞** –ø–µ—Ä–µ–¥ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–º –≤—ñ–∫–Ω–æ–º (–∑–∞ `wait_before` —Ö–≤–∏–ª–∏–Ω)
- üå°Ô∏è **–û—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è** –ø—Ä–∏–Ω—Ç–µ—Ä–∞ (M140 S0, M104 S0)
- ‚è≥ **–ì–Ω—É—á–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `wait_before` —Ç–∞ `wait_after`
- ‚ñ∂Ô∏è **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è** –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—ñ–∫–Ω–∞
- üìä **–î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è** —É —Ñ–∞–π–ª
- üéÆ **–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –º–µ–Ω—é** (bash –æ–±–µ—Ä—Ç–∫–∞)

## üì¶ –§–∞–π–ª–∏

- **`printer_power_manager_standalone.py`** - –û—Å–Ω–æ–≤–Ω–∏–π Python —Å–∫—Ä–∏–ø—Ç
- **`printer_power_manager.sh`** - Bash –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–í—ñ–¥–∫—Ä–∏–π `printer_power_manager_standalone.py` —ñ –∑–º—ñ–Ω—é–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:

```python
# Moonraker –∞–¥—Ä–µ—Å–∞ (–¥–µ —Ç–≤—ñ–π –ø—Ä–∏–Ω—Ç–µ—Ä)
MOONRAKER_URL = "http://localhost:7125"

# –¢–≤–æ—è –≥—Ä—É–ø–∞ –î–¢–ï–ö (1.1-6.2)
PRINTER_GROUP = "1.1"

# –Ü–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (—Å–µ–∫—É–Ω–¥–∏)
CHECK_INTERVAL = 60

# üÜï –•–≤–∏–ª–∏–Ω–∏ –î–û –≤—ñ–∫–Ω–∞ –∫–æ–ª–∏ —Å—Ç–∞–≤–∏—Ç–∏ –ø–∞—É–∑—É
WAIT_BEFORE = 5
# –ü—Ä–∏–∫–ª–∞–¥: –≤—ñ–∫–Ω–æ –≤ 16:00 + 5 —Ö–≤–∏–ª–∏–Ω = –ø–∞—É–∑–∞ –≤ 15:55

# üÜï –•–≤–∏–ª–∏–Ω–∏ –ü–Ü–°–õ–Ø –≤—ñ–∫–Ω–∞ –ø–µ—Ä–µ–¥ RESUME
WAIT_AFTER = 10
# –ü—Ä–∏–∫–ª–∞–¥: –ø–∞—É–∑–∞ –≤ 18:50, RESUME —Å–ø—Ä–æ–±–∞ –≤ 19:00 (—è–∫—â–æ wait_after=10)
```

## üöÄ –ó–∞–ø—É—Å–∫

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –º–µ–Ω—é (–†–ï–ö–û–ú–ï–ù–î–£–Ñ–¢–¨–°–Ø)

```bash
# –ó—Ä–æ–±–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º
chmod +x printer_power_manager.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ –º–µ–Ω—é
./printer_power_manager.sh
```

**–ú–µ–Ω—é:**
```
–í–∏–±–µ—Ä—ñ—Ç—å –¥—ñ—é:
  1) –°—Ç–∞—Ç—É—Å
  2) –ó–∞–ø—É—Å—Ç–∏—Ç–∏
  3) –ó—É–ø–∏–Ω–∏—Ç–∏
  4) –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
  5) –õ–æ–≥–∏
  6) –¢–µ—Å—Ç –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
  7) –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —è–∫ systemd —Å–µ—Ä–≤—ñ—Å
  0) –í–∏—Ö—ñ–¥
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ö–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥–µ–º–æ–Ω
./printer_power_manager.sh start

# –ó—É–ø–∏–Ω–∏—Ç–∏
./printer_power_manager.sh stop

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏
./printer_power_manager.sh restart

# –ü–æ–∫–∞–∑–∞—Ç–∏ –ª–æ–≥–∏
./printer_power_manager.sh logs

# –¢–µ—Å—Ç –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
./printer_power_manager.sh test

# –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å
./printer_power_manager.sh status
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ü—Ä—è–º–æ Python (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

```bash
# –û–¥–∏–Ω —Ä–∞–∑ (—Ç–µ—Å—Ç)
python3 printer_power_manager_standalone.py once

# –î–µ–º–æ–Ω (–ø–æ—Å—Ç—ñ–π–Ω–∞ —Ä–æ–±–æ—Ç–∞)
python3 printer_power_manager_standalone.py
```

### –í–∞—Ä—ñ–∞–Ω—Ç 4: Cron (–∫–æ–∂–Ω—É —Ö–≤–∏–ª–∏–Ω—É)

```bash
# –î–æ–¥–∞—Ç–∏ —É crontab
crontab -e

# –î–æ–¥–∞–π —Ä—è–¥–æ–∫:
*/1 * * * * /usr/bin/python3 /path/to/printer_power_manager_standalone.py once >> /path/to/printer.log 2>&1
```

### –í–∞—Ä—ñ–∞–Ω—Ç 5: Systemd —Å–µ—Ä–≤—ñ—Å (–ø–æ—Å—Ç—ñ–π–Ω–∞ —Ä–æ–±–æ—Ç–∞ –Ω–∞ Linux)

```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏
./printer_power_manager.sh install

# –ê–±–æ –≤—Ä—É—á–Ω—É:
sudo cp printer_power_manager.sh /usr/local/bin/
sudo systemctl daemon-reload
sudo systemctl enable printer-power-manager
sudo systemctl start printer-power-manager
sudo systemctl status printer-power-manager

# –õ–æ–≥–∏
sudo journalctl -u printer-power-manager -f
```

## üìä –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –õ–æ–≥—ñ–∫–∞ –∑ `wait_before` —Ç–∞ `wait_after`:

```
–í—ñ–∫–Ω–æ: 16:00 - 19:00
wait_before: 5 —Ö–≤–∏–ª–∏–Ω
wait_after: 10 —Ö–≤–∏–ª–∏–Ω

15:55 ‚Üí PAUSE + –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è (wait_before=5)
16:00 ‚Üí –í—ñ–∫–Ω–æ –ø–æ—á–∞–ª–æ
16:10 ‚Üí RESUME (wait_after=10 –≤—ñ–¥ 16:00)

–Ø–∫—â–æ RESUME –Ω–µ –≤–¥–∞–ª–æ—Å—å ‚Üí —á–µ–∫–∞—î–º–æ –¥–æ 19:00
19:00 ‚Üí –í—ñ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å ‚Üí RESUME
```

### –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥—ñ–≤:

```
2025-12-11 15:54:30 - WARNING - ‚ö†Ô∏è  –ù–ï–ë–ï–ó–ü–ï–ß–ù–ï –í–Ü–ö–ù–û –ë–õ–ò–ó–¨–ö–û: 16:00-19:00 (1.5 —Ö–≤–∏–ª–∏–Ω)
2025-12-11 15:54:31 - CRITICAL - üõë –°—Ç–∞–≤–ª—é –¥—Ä—É–∫ –Ω–∞ –ø–∞—É–∑—É (wait_before=5 —Ö–≤–∏–ª–∏–Ω)
2025-12-11 15:54:32 - INFO - ‚è∏Ô∏è  –ü–ê–£–ó–£ –î–†–£–ö!
2025-12-11 15:54:33 - WARNING - üå°Ô∏è  –í–∏–º–∏–∫–∞—é –Ω–∞–≥—Ä—ñ–≤–∞—á—ñ (M140 S0, M104 S0)
2025-12-11 15:54:34 - WARNING - ‚è∏Ô∏è  –î—Ä—É–∫ –Ω–∞ –ø–∞—É–∑—ñ –¥–æ 16:00-19:00

2025-12-11 16:10:00 - INFO - ‚úÖ wait_after=10 —Ö–≤–∏–ª–∏–Ω –ø—Ä–æ–π—à–ª–æ, –Ω–∞–º–∞–≥–∞—é—Å—å RESUME...
2025-12-11 16:10:01 - INFO - ‚ñ∂Ô∏è  –í–Ü–î–ù–û–í–õ–Æ–Æ –î–†–£–ö!
2025-12-11 16:10:02 - INFO - ‚ñ∂Ô∏è  –î—Ä—É–∫ —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ!
```

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### –¢–µ—Å—Ç –±–µ–∑ –∑–∞–ø—É—Å–∫—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–µ–º–æ–Ω–∞:

```bash
./printer_power_manager.sh test
# –∞–±–æ
python3 printer_power_manager_standalone.py once
```

–¶–µ –±—É–¥–µ:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥ –î–¢–ï–ö
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å –≤ –≤—ñ–∫–Ω—ñ
3. –ü–æ–∫–∞–∑–∞—Ç–∏ —â–æ –±—É–ª–æ –± –∑—Ä–æ–±–ª–µ–Ω–æ

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Moonraker API:

```bash
# –¢–µ—Å—Ç –∑–≤'—è–∑–∫—É –∑ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–º
curl -X POST http://localhost:7125/jsonrpc \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc":"2.0",
    "method":"printer.print.pause",
    "id":1
  }'
```

## üîß –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
# Python3 (–≤–∂–µ —î –Ω–∞ –±—ñ–ª—å—à–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º)
python3 --version

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ requests
pip3 install requests
```

## üìã –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –±–µ–∑–ø–µ–∫–∞)
```python
WAIT_BEFORE = 10  # –ü–∞—É–∑–∞ –∑–∞ 10 —Ö–≤–∏–ª–∏–Ω –î–û –≤—ñ–∫–Ω–∞
WAIT_AFTER = 20   # –û—á—ñ–∫—É–≤–∞–Ω–Ω—è 20 —Ö–≤–∏–ª–∏–Ω –ü–Ü–°–õ–Ø –ø–æ—á–∞—Ç–∫—É –≤—ñ–∫–Ω–∞
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º (–º—ñ–Ω—ñ–º—É–º –∑–∞—Ç—Ä–∏–º–æ–∫)
```python
WAIT_BEFORE = 1   # –ü–∞—É–∑–∞ –∑–∞ 1 —Ö–≤–∏–ª–∏–Ω—É
WAIT_AFTER = 1    # –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —á–µ—Ä–µ–∑ 1 —Ö–≤–∏–ª–∏–Ω—É
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –í–∏—Ä–æ–±–Ω–∏—á–∏–π —Ä–µ–∂–∏–º
```python
WAIT_BEFORE = 5   # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ
WAIT_AFTER = 10   # –ì–∞—Ä–Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–∞
CHECK_INTERVAL = 30  # –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Ä—ñ–¥—à–µ –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó —Ä–µ—Å—É—Ä—Å—ñ–≤
```

## üõ†Ô∏è –¢–∏–ø—ñ—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

| –ü—Ä–æ–±–ª–µ–º–∞ | –†—ñ—à–µ–Ω–Ω—è |
|----------|---------|
| `Connection refused` | –ü–µ—Ä–µ–≤—ñ—Ä MOONRAKER_URL —ñ —á–∏ –∑–∞–ø—É—â–µ–Ω–æ Moonraker |
| `Group not found` | –î—ñ–∑–Ω–∞–π—Å—è —Å–≤–æ—é –≥—Ä—É–ø—É –î–¢–ï–ö –Ω–∞ yasno.com.ua |
| `No module requests` | `pip3 install requests` |
| `Permission denied` | `chmod +x printer_power_manager.sh` |
| –°–∫—Ä–∏–ø—Ç –Ω–µ –ø–∞—É–∑–∏—Ç—å | –ó–∞–ø—É—Å—Ç–∏ `./printer_power_manager.sh test` —ñ –ø–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏ |
| –î—Ä—É–∫ –Ω–µ —Ä–µ–∑—é–º—É—î—Ç—å—Å—è | –ü–µ—Ä–µ–≤—ñ—Ä —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –≤ Moonraker UI |

## üìÇ –õ–æ–≥–∏

–õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤:
- **–§–∞–π–ª**: `printer_power_manager.log` (—É –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó)
- **Termina**l: —Ç–∞–∫–æ–∂ –≤–∏–¥–Ω–æ —É –∫–æ–Ω—Å–æ–ª—ñ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É

–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏:
```bash
# –û—Å—Ç–∞–Ω–Ω—ñ 20 —Ä—è–¥–∫—ñ–≤
tail -n 20 printer_power_manager.log

# –ü–æ—Å—Ç—ñ–π–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
tail -f printer_power_manager.log

# –¢–æ–ª—å–∫–æ –ø–æ–º–∏–ª–∫–∏
grep "ERROR\|‚ùå" printer_power_manager.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
grep "–ù–ï–ë–ï–ó–ü–ï–ß–ù–ï –í–Ü–ö–ù–û" printer_power_manager.log | wc -l
```

## üéÅ –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä —á–µ—Ä–µ–∑ SSH
scp printer_power_manager_standalone.py pi@192.168.1.100:/home/pi/
scp printer_power_manager.sh pi@192.168.1.100:/home/pi/

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —á–µ—Ä–µ–∑ SSH
ssh pi@192.168.1.100 "cd ~/printer_power_manager && ./printer_power_manager.sh start"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ SSH
ssh pi@192.168.1.100 "cd ~/printer_power_manager && ./printer_power_manager.sh status"

# –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥ –î–¢–ï–ö –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
curl -s "https://app.yasno.ua/api/blackout-service/public/shutdowns/regions/25/dsos/902/planned-outages" | python3 -m json.tool | grep -A 10 '"1.1"'
```

## ‚úÖ –ß–µ–∫–ª—ñ—Å—Ç –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

- [ ] –°–∫–∞—á–∞–≤ –æ–±–∏–¥–≤–∞ —Ñ–∞–π–ª–∏
- [ ] –î–∞–≤ –ø—Ä–∞–≤–∞: `chmod +x printer_power_manager.sh`
- [ ] –ó–Ω–∞–π—à–æ–≤ —Å–≤–æ—é –≥—Ä—É–ø—É –î–¢–ï–ö –Ω–∞ yasno.com.ua
- [ ] –ó–º—ñ–Ω–∏–≤ `PRINTER_GROUP = "1.1"` –Ω–∞ —Å–≤–æ—é –≥—Ä—É–ø—É
- [ ] –ó–º—ñ–Ω–∏–≤ `MOONRAKER_URL` –Ω–∞ –∞–¥—Ä–µ—Å—É —Å–≤–æ–≥–æ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
- [ ] –ó–∞–ø—É—Å—Ç–∏–≤ —Ç–µ—Å—Ç: `./printer_power_manager.sh test`
- [ ] –ó–∞–ø—É—Å—Ç–∏–≤ –¥–µ–º–æ–Ω: `./printer_power_manager.sh start`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤ –ª–æ–≥–∏: `./printer_power_manager.sh logs`
- [ ] –î–æ–¥–∞–≤ —É –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ (systemd/cron)

## üöÄ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Ç–≤—ñ–π –ø—Ä–∏–Ω—Ç–µ—Ä:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–∞—É–∑–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–º –≤—ñ–∫–Ω–æ–º
- ‚úÖ –û—Ö–æ–ª–æ–¥–∂—É—î—Ç—å—Å—è (–Ω–µ –≥–æ—Ä–∏—Ç—å –¢–ï–ù –∑—Ä—è)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤—ñ–∫–Ω–∞
- ‚úÖ –õ–æ–≥—É—î –≤—Å–µ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É

**–£—Å–ø—ñ—Ö—É –∑ 3D –¥—Ä—É–∫–æ–º! üñ®Ô∏èüéâ**

---

**–ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞?** - –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç —ñ –≤—ñ–¥–ø—Ä–∞–≤ –ª–æ–≥–∏:
```bash
./printer_power_manager.sh test
cat printer_power_manager.log
```
